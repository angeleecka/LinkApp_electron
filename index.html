<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline';
             font-src 'self' data:; script-src 'self'; connect-src 'self' https:;"
    />

    <title>Linkapp v2 — dev</title>

    <link rel="stylesheet" href="./assets/css/base.css" />

    <!-- только vars -->
    <link rel="stylesheet" href="./assets/css/layout.css" />
    <link rel="stylesheet" href="./assets/css/header.css" />
    <link rel="stylesheet" href="./assets/css/pages.css" />

    <link rel="stylesheet" href="./assets/css/sections.css" />
    <link rel="stylesheet" href="./assets/css/buttons.css" />
    <link rel="stylesheet" href="./assets/css/pagination.css" />
    <link rel="stylesheet" href="./assets/css/modals.css" />
    <link rel="stylesheet" href="./assets/css/history.css" />
    <link rel="stylesheet" href="./assets/css/toast.css" />
    <link rel="stylesheet" href="./assets/css/statusbar.css" />
    <link rel="stylesheet" href="./assets/css/theme.css" />
    <link rel="stylesheet" href="./assets/css/panel.css" />

    <link rel="icon" type="image/png" href="favicon.png" sizes="16x16" />
  </head>
  <body>
    <div id="linkapp-root">
      <!-- header, body, footer will be injected -->
    </div>

    <!-- Toast container + modals root -->
    <div id="toast-container"></div>
    <div id="modals-root"></div>

    <!-- <div id="pagination"></div> -->

    <script type="module" src="./main.js"></script>
    <script>
      /**
       * Мини-зонд кликов:
       * 1) Логирует ЛЮБОЙ клик на документе (в фазе capture).
       * 2) Показывает, какой элемент реально под курсором (overlay-проверка).
       * 3) Даёт две утилиты в консоли: listButtons() и inspectBtn(selector).
       */
      (function () {
        // 1) Глобальный лог кликов — если это не срабатывает, клики блокируются где-то выше (оверлей)
        window.addEventListener(
          "click",
          function (e) {
            const x = e.clientX,
              y = e.clientY;
            const topEl = document.elementFromPoint(x, y);
            const path = e.composedPath ? e.composedPath() : [];
            console.log("[CAPTURE click]", {
              x,
              y,
              target: e.target,
              topEl,
              pathFirst: path[0],
            });
          },
          true
        );

        // 2) Утилита: список «кнопок», которые мы видим в DOM сейчас
        window.listButtons = function () {
          const nodes = Array.from(
            document.querySelectorAll(
              'button, [role="button"], [data-action], a[onclick]'
            )
          );
          const rows = nodes.map((el, i) => {
            const cs = getComputedStyle(el);
            return {
              i,
              tag: el.tagName.toLowerCase(),
              id: el.id || "",
              class: el.className || "",
              text: (el.innerText || "").trim().slice(0, 40),
              visible: !(
                cs.display === "none" ||
                cs.visibility === "hidden" ||
                cs.opacity === "0"
              ),
              disabled: !!(
                el.disabled || el.getAttribute("aria-disabled") === "true"
              ),
              pointerEvents: cs.pointerEvents,
            };
          });
          console.table(rows);
          return rows;
        };

        // 3) Утилита: точечная проверка конкретной кнопки по селектору
        window.inspectBtn = function (selector) {
          const el = document.querySelector(selector);
          if (!el) {
            console.warn("inspectBtn: элемент не найден:", selector);
            return null;
          }
          const r = el.getBoundingClientRect();
          const topEl = document.elementFromPoint(
            r.left + r.width / 2,
            r.top + r.height / 2
          );
          const cs = getComputedStyle(el);
          const info = {
            exists: !!el,
            text: (el.innerText || "").trim(),
            centerTopEl: topEl
              ? `${topEl.tagName.toLowerCase()}#${topEl.id}.${topEl.className}`
              : null,
            visible: !(
              cs.display === "none" ||
              cs.visibility === "hidden" ||
              cs.opacity === "0"
            ),
            disabled: !!(
              el.disabled || el.getAttribute("aria-disabled") === "true"
            ),
            pointerEvents: cs.pointerEvents,
            zIndex: cs.zIndex,
            hasOnclickProp: typeof el.onclick === "function",
          };
          console.table(info);
          return info;
        };

        // 4) Быстрый обзор подключённых скриптов — вдруг нужный не загрузился
        window.listScripts = function () {
          const rows = Array.from(document.scripts).map((s, i) => ({
            i,
            type: s.type || "classic",
            src: s.src || "(inline)",
            module: s.type === "module",
          }));
          console.table(rows);
          return rows;
        };
      })();
    </script>
  </body>
</html>
